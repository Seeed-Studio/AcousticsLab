#include "feature_generator.h"
#include <cmath>
#include <cstring>
#include <esp_heap_caps.h>
#include <esp_log.h>

static const char *TAG = "FeatureGenerator";
static const float g_hanning_window[CONFIG_FRAME_LEN]
    = { 1.490116119384766e-08f, 8.642673492431641e-07f, 3.412365913391113e-06f, 7.651746273040771e-06f,
          1.356005668640137e-05f, 2.119690179824829e-05f, 3.050267696380615e-05f, 4.153698682785034e-05f,
          5.424022674560547e-05f, 6.864219903945923e-05f, 8.475035429000854e-05f, 1.025572419166565e-04f,
          1.220405101776123e-04f, 1.432597637176514e-04f, 1.661553978919983e-04f, 1.907572150230408e-04f,
          2.170652151107788e-04f, 2.450644969940186e-04f, 2.747997641563416e-04f, 3.061890602111816e-04f,
          3.393292427062988e-04f, 3.741532564163208e-04f, 4.107058048248291e-04f, 4.489496350288391e-04f,
          4.889219999313354e-04f, 5.305930972099304e-04f, 5.739927291870117e-04f, 6.190985441207886e-04f,
          6.659179925918579e-04f, 7.144734263420105e-04f, 7.647424936294556e-04f, 8.167400956153870e-04f,
          8.704736828804016e-04f, 9.259432554244995e-04f, 9.831115603446960e-04f, 1.042030751705170e-03f,
          1.102693378925323e-03f, 1.165099442005157e-03f, 1.229248940944672e-03f, 1.295119524002075e-03f,
          1.362733542919159e-03f, 1.432135701179504e-03f, 1.503244042396545e-03f, 1.576155424118042e-03f,
          1.650765538215637e-03f, 1.727193593978882e-03f, 1.805365085601807e-03f, 1.885294914245605e-03f,
          1.966990530490875e-03f, 2.050474286079407e-03f, 2.135701477527618e-03f, 2.222746610641479e-03f,
          2.311564981937408e-03f, 2.402171492576599e-03f, 2.494551241397858e-03f, 2.588726580142975e-03f,
          2.684712409973145e-03f, 2.782508730888367e-03f, 2.882100641727448e-03f, 2.983480691909790e-03f,
          3.086701035499573e-03f, 3.191724419593811e-03f, 3.298565745353699e-03f, 3.407225012779236e-03f,
          3.517746925354004e-03f, 3.630079329013824e-03f, 3.744229674339294e-03f, 3.860250115394592e-03f,
          3.978103399276733e-03f, 4.097826778888702e-03f, 4.219390451908112e-03f, 4.342801868915558e-03f,
          4.468105733394623e-03f, 4.595242440700531e-03f, 4.724293947219849e-03f, 4.855185747146606e-03f,
          4.987977445125580e-03f, 5.122661590576172e-03f, 5.259230732917786e-03f, 5.397707223892212e-03f,
          5.538083612918854e-03f, 5.680367350578308e-03f, 5.824588239192963e-03f, 5.970701575279236e-03f,
          6.118737161159515e-03f, 6.268724799156189e-03f, 6.420627236366272e-03f, 6.574481725692749e-03f,
          6.730280816555023e-03f, 6.888017058372498e-03f, 7.047720253467560e-03f, 7.209412753582001e-03f,
          7.373049855232239e-03f, 7.538676261901855e-03f, 7.706254720687866e-03f, 7.875852286815643e-03f,
          8.047409355640411e-03f, 8.220978081226349e-03f, 8.396558463573456e-03f, 8.574165403842926e-03f,
          8.753791451454163e-03f, 8.935421705245972e-03f, 9.119071066379547e-03f, 9.304791688919067e-03f,
          9.492538869380951e-03f, 9.682312607765198e-03f, 9.874179959297180e-03f, 1.006808131933212e-02f,
          1.026407629251480e-02f, 1.046213507652283e-02f, 1.066227257251740e-02f, 1.086449623107910e-02f,
          1.106882095336914e-02f, 1.127523183822632e-02f, 1.148379221558571e-02f, 1.169442757964134e-02f,
          1.190721616148949e-02f, 1.212213560938835e-02f, 1.233916357159615e-02f, 1.255837455391884e-02f,
          1.277969777584076e-02f, 1.300319284200668e-02f, 1.322888582944870e-02f, 1.345672085881233e-02f,
          1.368674635887146e-02f, 1.391896605491638e-02f, 1.415336504578590e-02f, 1.438996940851212e-02f,
          1.462880149483681e-02f, 1.486982777714729e-02f, 1.511309668421745e-02f, 1.535860449075699e-02f,
          1.560631766915321e-02f, 1.585633680224419e-02f, 1.610858365893364e-02f, 1.636306941509247e-02f,
          1.661986857652664e-02f, 1.687891036272049e-02f, 1.714025810360909e-02f, 1.740390807390213e-02f,
          1.766983792185783e-02f, 1.793809235095978e-02f, 1.820868253707886e-02f, 1.848159730434418e-02f,
          1.875682175159454e-02f, 1.903441920876503e-02f, 1.931435614824295e-02f, 1.959664374589920e-02f,
          1.988129690289497e-02f, 2.016835659742355e-02f, 2.045778185129166e-02f, 2.074958384037018e-02f,
          2.104380726814270e-02f, 2.134043723344803e-02f, 2.163947001099586e-02f, 2.194096148014069e-02f,
          2.224484831094742e-02f, 2.255120128393173e-02f, 2.286000922322273e-02f, 2.317128702998161e-02f,
          2.348501607775688e-02f, 2.380121499300003e-02f, 2.411990240216255e-02f, 2.444108575582504e-02f,
          2.476477995514870e-02f, 2.509098127484322e-02f, 2.541970089077950e-02f, 2.575094997882843e-02f,
          2.608474716544151e-02f, 2.642107754945755e-02f, 2.675996720790863e-02f, 2.710141614079475e-02f,
          2.744544669985771e-02f, 2.779204770922661e-02f, 2.814126014709473e-02f, 2.849304676055908e-02f,
          2.884744852781296e-02f, 2.920446544885635e-02f, 2.956411615014076e-02f, 2.992640808224678e-02f,
          3.029132261872292e-02f, 3.065890446305275e-02f, 3.102914616465569e-02f, 3.140205517411232e-02f,
          3.177763521671295e-02f, 3.215591236948967e-02f, 3.253687918186188e-02f, 3.292059153318405e-02f,
          3.330699354410172e-02f, 3.369608148932457e-02f, 3.408795967698097e-02f, 3.448253124952316e-02f,
          3.487989306449890e-02f, 3.528000414371490e-02f, 3.568288683891296e-02f, 3.608854860067368e-02f,
          3.649698942899704e-02f, 3.690821677446365e-02f, 3.732226043939590e-02f, 3.773912414908409e-02f,
          3.815879672765732e-02f, 3.858133032917976e-02f, 3.900668025016785e-02f, 3.943489491939545e-02f,
          3.986596316099167e-02f, 4.029991477727890e-02f, 4.073670506477356e-02f, 4.117643460631371e-02f,
          4.161903262138367e-02f, 4.206453263759613e-02f, 4.251296818256378e-02f, 4.296431317925453e-02f,
          4.341857880353928e-02f, 4.387580975890160e-02f, 4.433598369359970e-02f, 4.479911550879478e-02f,
          4.526522010564804e-02f, 4.573429375886917e-02f, 4.620635509490967e-02f, 4.668143391609192e-02f,
          4.715950414538383e-02f, 4.764060676097870e-02f, 4.812470823526382e-02f, 4.861184954643250e-02f,
          4.910201951861382e-02f, 4.959524795413017e-02f, 5.009153485298157e-02f, 5.059090256690979e-02f,
          5.109334737062454e-02f, 5.159888043999672e-02f, 5.210749432444572e-02f, 5.261920765042305e-02f,
          5.313404276967049e-02f, 5.365197733044624e-02f, 5.417305976152420e-02f, 5.469731613993645e-02f,
          5.522467195987701e-02f, 5.575520545244217e-02f, 5.628890544176102e-02f, 5.682576820254326e-02f,
          5.736582726240158e-02f, 5.790907517075539e-02f, 5.845553427934647e-02f, 5.900519341230392e-02f,
          5.955803766846657e-02f, 6.011414900422096e-02f, 6.067349389195442e-02f, 6.123607233166695e-02f,
          6.180188059806824e-02f, 6.237099692225456e-02f, 6.294332444667816e-02f, 6.351899355649948e-02f,
          6.409791111946106e-02f, 6.468010693788528e-02f, 6.526563316583633e-02f, 6.585448235273361e-02f,
          6.644666194915771e-02f, 6.704214215278625e-02f, 6.764095276594162e-02f, 6.824310123920441e-02f,
          6.884860247373581e-02f, 6.945747137069702e-02f, 7.006973773241043e-02f, 7.068534195423126e-02f,
          7.130434364080429e-02f, 7.192675024271011e-02f, 7.255253940820694e-02f, 7.318173348903656e-02f,
          7.381434738636017e-02f, 7.445040345191956e-02f, 7.508988678455353e-02f, 7.573281228542328e-02f,
          7.637917995452881e-02f, 7.702899724245071e-02f, 7.768227159976959e-02f, 7.833905518054962e-02f,
          7.899928838014603e-02f, 7.966302335262299e-02f, 8.033023774623871e-02f, 8.100096136331558e-02f,
          8.167517185211182e-02f, 8.235291391611099e-02f, 8.303417265415192e-02f, 8.371897041797638e-02f,
          8.440731465816498e-02f, 8.509918302297592e-02f, 8.579462021589279e-02f, 8.649362623691559e-02f,
          8.719615638256073e-02f, 8.790230005979538e-02f, 8.861200511455536e-02f, 8.932528644800186e-02f,
          9.004218876361847e-02f, 9.076266735792160e-02f, 9.148678183555603e-02f, 9.221448004245758e-02f,
          9.294581413269043e-02f, 9.368076920509338e-02f, 9.441936016082764e-02f, 9.516161680221558e-02f,
          9.590748697519302e-02f, 9.665703028440475e-02f, 9.741021692752838e-02f, 9.816706925630569e-02f,
          9.892761707305908e-02f, 9.969180822372437e-02f, 1.004597172141075e-01f, 1.012312844395638e-01f,
          1.020065546035767e-01f, 1.027855351567268e-01f, 1.035682186484337e-01f, 1.043546274304390e-01f,
          1.051447391510010e-01f, 1.059385836124420e-01f, 1.067361682653427e-01f, 1.075374633073807e-01f,
          1.083425283432007e-01f, 1.091513037681580e-01f, 1.099638640880585e-01f, 1.107801869511604e-01f,
          1.116002500057220e-01f, 1.124240756034851e-01f, 1.132516786456108e-01f, 1.140830516815186e-01f,
          1.149182170629501e-01f, 1.157571747899055e-01f, 1.165999025106430e-01f, 1.174464747309685e-01f,
          1.182968169450760e-01f, 1.191509515047073e-01f, 1.200089305639267e-01f, 1.208706945180893e-01f,
          1.217362806200981e-01f, 1.226057112216949e-01f, 1.234789341688156e-01f, 1.243560239672661e-01f,
          1.252369284629822e-01f, 1.261216849088669e-01f, 1.270102709531784e-01f, 1.279027163982391e-01f,
          1.287989765405655e-01f, 1.296991258859634e-01f, 1.306031197309494e-01f, 1.315109878778458e-01f,
          1.324227154254913e-01f, 1.333383172750473e-01f, 1.342577934265137e-01f, 1.351811140775681e-01f,
          1.361083388328552e-01f, 1.370394378900528e-01f, 1.379744112491608e-01f, 1.389132738113403e-01f,
          1.398560404777527e-01f, 1.408026665449142e-01f, 1.417532116174698e-01f, 1.427076458930969e-01f,
          1.436659991741180e-01f, 1.446282416582108e-01f, 1.455943882465363e-01f, 1.465644538402557e-01f,
          1.475384235382080e-01f, 1.485162973403931e-01f, 1.494980752468109e-01f, 1.504837721586227e-01f,
          1.514733880758286e-01f, 1.524669229984283e-01f, 1.534643769264221e-01f, 1.544657051563263e-01f,
          1.554709970951080e-01f, 1.564802080392838e-01f, 1.574933528900146e-01f, 1.585104167461395e-01f,
          1.595314145088196e-01f, 1.605563312768936e-01f, 1.615851670503616e-01f, 1.626179516315460e-01f,
          1.636546552181244e-01f, 1.646952927112579e-01f, 1.657398641109467e-01f, 1.667883396148682e-01f,
          1.678407788276672e-01f, 1.688970923423767e-01f, 1.699573844671249e-01f, 1.710215955972672e-01f,
          1.720897555351257e-01f, 1.731618344783783e-01f, 1.742378473281860e-01f, 1.753177940845490e-01f,
          1.764016598463058e-01f, 1.774894595146179e-01f, 1.785811930894852e-01f, 1.796768456697464e-01f,
          1.807764321565628e-01f, 1.818799376487732e-01f, 1.829873621463776e-01f, 1.840986907482147e-01f,
          1.852139532566071e-01f, 1.863331645727158e-01f, 1.874562799930573e-01f, 1.885833144187927e-01f,
          1.897142529487610e-01f, 1.908491253852844e-01f, 1.919878870248795e-01f, 1.931305825710297e-01f,
          1.942771822214127e-01f, 1.954276859760284e-01f, 1.965820640325546e-01f, 1.977403759956360e-01f,
          1.989025771617889e-01f, 2.000686228275299e-01f, 2.012386322021484e-01f, 2.024124860763550e-01f,
          2.035902589559555e-01f, 2.047719061374664e-01f, 2.059574425220490e-01f, 2.071468383073807e-01f,
          2.083401381969452e-01f, 2.095372676849365e-01f, 2.107382863759995e-01f, 2.119431793689728e-01f,
          2.131519019603729e-01f, 2.143644988536835e-01f, 2.155809700489044e-01f, 2.168012112379074e-01f,
          2.180253267288208e-01f, 2.192533016204834e-01f, 2.204851061105728e-01f, 2.217207700014114e-01f,
          2.229602336883545e-01f, 2.242035120725632e-01f, 2.254506051540375e-01f, 2.267015427350998e-01f,
          2.279562503099442e-01f, 2.292147874832153e-01f, 2.304770648479462e-01f, 2.317431867122650e-01f,
          2.330130040645599e-01f, 2.342866659164429e-01f, 2.355640828609467e-01f, 2.368453145027161e-01f,
          2.381302714347839e-01f, 2.394189834594727e-01f, 2.407114505767822e-01f, 2.420076429843903e-01f,
          2.433075606822968e-01f, 2.446112483739853e-01f, 2.459186166524887e-01f, 2.472297400236130e-01f,
          2.485445290803909e-01f, 2.498630285263062e-01f, 2.511851787567139e-01f, 2.525110840797424e-01f,
          2.538406252861023e-01f, 2.551738917827606e-01f, 2.565107941627502e-01f, 2.578513622283936e-01f,
          2.591955661773682e-01f, 2.605434060096741e-01f, 2.618948817253113e-01f, 2.632499933242798e-01f,
          2.646087408065796e-01f, 2.659710347652435e-01f, 2.673369646072388e-01f, 2.687065005302429e-01f,
          2.700795531272888e-01f, 2.714562118053436e-01f, 2.728364467620850e-01f, 2.742202579975128e-01f,
          2.756075859069824e-01f, 2.769984602928162e-01f, 2.783928513526917e-01f, 2.797907888889313e-01f,
          2.811922132968903e-01f, 2.825971245765686e-01f, 2.840055227279663e-01f, 2.854174375534058e-01f,
          2.868328094482422e-01f, 2.882516086101532e-01f, 2.896738052368164e-01f, 2.910994887351990e-01f,
          2.925286293029785e-01f, 2.939611673355103e-01f, 2.953971028327942e-01f, 2.968364357948303e-01f,
          2.982791662216187e-01f, 2.997252941131592e-01f, 3.011747300624847e-01f, 3.026275038719177e-01f,
          3.040836453437805e-01f, 3.055431246757507e-01f, 3.070058822631836e-01f, 3.084719777107239e-01f,
          3.099412918090820e-01f, 3.114139139652252e-01f, 3.128898441791534e-01f, 3.143689930438995e-01f,
          3.158513903617859e-01f, 3.173370361328125e-01f, 3.188259005546570e-01f, 3.203179538249969e-01f,
          3.218131959438324e-01f, 3.233116269111633e-01f, 3.248131871223450e-01f, 3.263179659843445e-01f,
          3.278258144855499e-01f, 3.293367922306061e-01f, 3.308508396148682e-01f, 3.323680758476257e-01f,
          3.338883519172668e-01f, 3.354116976261139e-01f, 3.369380831718445e-01f, 3.384675681591034e-01f,
          3.400000333786011e-01f, 3.415355384349823e-01f, 3.430740237236023e-01f, 3.446154892444611e-01f,
          3.461599349975586e-01f, 3.477073311805725e-01f, 3.492576479911804e-01f, 3.508108258247375e-01f,
          3.523669838905334e-01f, 3.539260625839233e-01f, 3.554879724979401e-01f, 3.570527732372284e-01f,
          3.586204051971436e-01f, 3.601908683776855e-01f, 3.617641627788544e-01f, 3.633402287960052e-01f,
          3.649191260337830e-01f, 3.665007352828979e-01f, 3.680851161479950e-01f, 3.696722388267517e-01f,
          3.712620735168457e-01f, 3.728545308113098e-01f, 3.744497597217560e-01f, 3.760476708412170e-01f,
          3.776481747627258e-01f, 3.792513608932495e-01f, 3.808571398258209e-01f, 3.824655413627625e-01f,
          3.840764760971069e-01f, 3.856900036334991e-01f, 3.873060941696167e-01f, 3.889246881008148e-01f,
          3.905458152294159e-01f, 3.921694159507751e-01f, 3.937954902648926e-01f, 3.954239785671234e-01f,
          3.970549702644348e-01f, 3.986883461475372e-01f, 4.003241360187531e-01f, 4.019623100757599e-01f,
          4.036028683185577e-01f, 4.052457809448242e-01f, 4.068909883499146e-01f, 4.085384905338287e-01f,
          4.101883172988892e-01f, 4.118404090404510e-01f, 4.134947359561920e-01f, 4.151512980461121e-01f,
          4.168100655078888e-01f, 4.184709787368774e-01f, 4.201341569423676e-01f, 4.217994213104248e-01f,
          4.234668612480164e-01f, 4.251363873481750e-01f, 4.268080294132233e-01f, 4.284817278385162e-01f,
          4.301574826240540e-01f, 4.318352341651917e-01f, 4.335150718688965e-01f, 4.351968169212341e-01f,
          4.368806183338165e-01f, 4.385663270950317e-01f, 4.402539432048798e-01f, 4.419434070587158e-01f,
          4.436348080635071e-01f, 4.453281164169312e-01f, 4.470232427120209e-01f, 4.487201571464539e-01f,
          4.504189789295197e-01f, 4.521194696426392e-01f, 4.538217484951019e-01f, 4.555258154869080e-01f,
          4.572315216064453e-01f, 4.589389562606812e-01f, 4.606480598449707e-01f, 4.623588025569916e-01f,
          4.640712141990662e-01f, 4.657850861549377e-01f, 4.675006270408630e-01f, 4.692177474498749e-01f,
          4.709364473819733e-01f, 4.726566076278687e-01f, 4.743781983852386e-01f, 4.761013388633728e-01f,
          4.778259396553040e-01f, 4.795519411563873e-01f, 4.812792837619781e-01f, 4.830080270767212e-01f,
          4.847381114959717e-01f, 4.864696264266968e-01f, 4.882022440433502e-01f, 4.899362921714783e-01f,
          4.916716217994690e-01f, 4.934080839157104e-01f, 4.951457977294922e-01f, 4.968847036361694e-01f,
          4.986248314380646e-01f, 5.003660321235657e-01f, 5.021083354949951e-01f, 5.038517713546753e-01f,
          5.055962204933167e-01f, 5.073417425155640e-01f, 5.090883374214172e-01f, 5.108358860015869e-01f,
          5.125842690467834e-01f, 5.143337249755859e-01f, 5.160840749740601e-01f, 5.178353786468506e-01f,
          5.195874571800232e-01f, 5.213404297828674e-01f, 5.230941772460938e-01f, 5.248488187789917e-01f,
          5.266041159629822e-01f, 5.283601880073547e-01f, 5.301170349121094e-01f, 5.318745374679565e-01f,
          5.336327552795410e-01f, 5.353915095329285e-01f, 5.371508598327637e-01f, 5.389108657836914e-01f,
          5.406714677810669e-01f, 5.424326062202454e-01f, 5.441941618919373e-01f, 5.459563136100769e-01f,
          5.477188825607300e-01f, 5.494818687438965e-01f, 5.512452721595764e-01f, 5.530090928077698e-01f,
          5.547732114791870e-01f, 5.565377473831177e-01f, 5.583025217056274e-01f, 5.600675940513611e-01f,
          5.618327856063843e-01f, 5.635982751846313e-01f, 5.653640627861023e-01f, 5.671299695968628e-01f,
          5.688959956169128e-01f, 5.706621408462524e-01f, 5.724284052848816e-01f, 5.741946697235107e-01f,
          5.759609341621399e-01f, 5.777273178100586e-01f, 5.794936418533325e-01f, 5.812599062919617e-01f,
          5.830261111259460e-01f, 5.847921967506409e-01f, 5.865581631660461e-01f, 5.883239507675171e-01f,
          5.900896191596985e-01f, 5.918550491333008e-01f, 5.936202406883240e-01f, 5.953851342201233e-01f,
          5.971497297286987e-01f, 5.989140868186951e-01f, 6.006780266761780e-01f, 6.024416089057922e-01f,
          6.042047739028931e-01f, 6.059674620628357e-01f, 6.077297925949097e-01f, 6.094915270805359e-01f,
          6.112528443336487e-01f, 6.130135655403137e-01f, 6.147737503051758e-01f, 6.165332794189453e-01f,
          6.182922124862671e-01f, 6.200504302978516e-01f, 6.218080520629883e-01f, 6.235647201538086e-01f,
          6.253208518028259e-01f, 6.270762681961060e-01f, 6.288307905197144e-01f, 6.305844783782959e-01f,
          6.323373317718506e-01f, 6.340892910957336e-01f, 6.358404159545898e-01f, 6.375905275344849e-01f,
          6.393396854400635e-01f, 6.410878300666809e-01f, 6.428349018096924e-01f, 6.445810198783875e-01f,
          6.463259458541870e-01f, 6.480698585510254e-01f, 6.498125195503235e-01f, 6.515541672706604e-01f,
          6.532944440841675e-01f, 6.550335884094238e-01f, 6.567714214324951e-01f, 6.585080623626709e-01f,
          6.602433323860168e-01f, 6.619771718978882e-01f, 6.637097001075745e-01f, 6.654407978057861e-01f,
          6.671705245971680e-01f, 6.688988208770752e-01f, 6.706253886222839e-01f, 6.723506450653076e-01f,
          6.740742921829224e-01f, 6.757963895797729e-01f, 6.775168776512146e-01f, 6.792357563972473e-01f,
          6.809529066085815e-01f, 6.826684474945068e-01f, 6.843822002410889e-01f, 6.860942244529724e-01f,
          6.878044605255127e-01f, 6.895127892494202e-01f, 6.912194490432739e-01f, 6.929240822792053e-01f,
          6.946269869804382e-01f, 6.963278651237488e-01f, 6.980267167091370e-01f, 6.997236609458923e-01f,
          7.014185190200806e-01f, 7.031114101409912e-01f, 7.048022150993347e-01f, 7.064909338951111e-01f,
          7.081774473190308e-01f, 7.098618745803833e-01f, 7.115440368652344e-01f, 7.132240533828735e-01f,
          7.149018049240112e-01f, 7.165772318840027e-01f, 7.182502150535583e-01f, 7.199209928512573e-01f,
          7.215894460678101e-01f, 7.232553958892822e-01f, 7.249190807342529e-01f, 7.265802025794983e-01f,
          7.282388806343079e-01f, 7.298949360847473e-01f, 7.315485477447510e-01f, 7.331995964050293e-01f,
          7.348480224609375e-01f, 7.364938259124756e-01f, 7.381369471549988e-01f, 7.397773861885071e-01f,
          7.414150834083557e-01f, 7.430500984191895e-01f, 7.446821928024292e-01f, 7.463116645812988e-01f,
          7.479381561279297e-01f, 7.495618462562561e-01f, 7.511826157569885e-01f, 7.528004646301270e-01f,
          7.544154524803162e-01f, 7.560274004936218e-01f, 7.576362490653992e-01f, 7.592421770095825e-01f,
          7.608450055122375e-01f, 7.624447345733643e-01f, 7.640411257743835e-01f, 7.656345963478088e-01f,
          7.672248482704163e-01f, 7.688118815422058e-01f, 7.703956365585327e-01f, 7.719761729240417e-01f,
          7.735533714294434e-01f, 7.751272320747375e-01f, 7.766978740692139e-01f, 7.782649993896484e-01f,
          7.798287272453308e-01f, 7.813890576362610e-01f, 7.829458713531494e-01f, 7.844992280006409e-01f,
          7.860490083694458e-01f, 7.875952720642090e-01f, 7.891379594802856e-01f, 7.906769514083862e-01f,
          7.922123670578003e-01f, 7.937440872192383e-01f, 7.952721714973450e-01f, 7.967964410781860e-01f,
          7.983170151710510e-01f, 7.998337745666504e-01f, 8.013467192649841e-01f, 8.028559088706970e-01f,
          8.043611049652100e-01f, 8.058623671531677e-01f, 8.073598742485046e-01f, 8.088533282279968e-01f,
          8.103428483009338e-01f, 8.118283748626709e-01f, 8.133098483085632e-01f, 8.147872686386108e-01f,
          8.162605762481689e-01f, 8.177297711372375e-01f, 8.191949129104614e-01f, 8.206558227539062e-01f,
          8.221125006675720e-01f, 8.235649466514587e-01f, 8.250131607055664e-01f, 8.264571428298950e-01f,
          8.278967738151550e-01f, 8.293320536613464e-01f, 8.307629823684692e-01f, 8.321895599365234e-01f,
          8.336116671562195e-01f, 8.350293636322021e-01f, 8.364425897598267e-01f, 8.378512859344482e-01f,
          8.392555713653564e-01f, 8.406552672386169e-01f, 8.420502543449402e-01f, 8.434407711029053e-01f,
          8.448266386985779e-01f, 8.462077379226685e-01f, 8.475841879844666e-01f, 8.489560484886169e-01f,
          8.503230810165405e-01f, 8.516854047775269e-01f, 8.530429601669312e-01f, 8.543956875801086e-01f,
          8.557436466217041e-01f, 8.570865988731384e-01f, 8.584247827529907e-01f, 8.597579598426819e-01f,
          8.610863089561462e-01f, 8.624095916748047e-01f, 8.637279272079468e-01f, 8.650412559509277e-01f,
          8.663495182991028e-01f, 8.676527142524719e-01f, 8.689508438110352e-01f, 8.702438473701477e-01f,
          8.715317249298096e-01f, 8.728144168853760e-01f, 8.740919232368469e-01f, 8.753641843795776e-01f,
          8.766312599182129e-01f, 8.778930306434631e-01f, 8.791495561599731e-01f, 8.804007172584534e-01f,
          8.816465735435486e-01f, 8.828870058059692e-01f, 8.841220140457153e-01f, 8.853517770767212e-01f,
          8.865760564804077e-01f, 8.877948522567749e-01f, 8.890081644058228e-01f, 8.902160525321960e-01f,
          8.914182782173157e-01f, 8.926150798797607e-01f, 8.938062191009521e-01f, 8.949917554855347e-01f,
          8.961717486381531e-01f, 8.973460793495178e-01f, 8.985146284103394e-01f, 8.996776938438416e-01f,
          9.008349180221558e-01f, 9.019864201545715e-01f, 9.031321406364441e-01f, 9.042720794677734e-01f,
          9.054063558578491e-01f, 9.065346717834473e-01f, 9.076572060585022e-01f, 9.087737798690796e-01f,
          9.098845124244690e-01f, 9.109894037246704e-01f, 9.120882749557495e-01f, 9.131812453269958e-01f,
          9.142681360244751e-01f, 9.153491258621216e-01f, 9.164239764213562e-01f, 9.174929261207581e-01f,
          9.185557961463928e-01f, 9.196125864982605e-01f, 9.206631779670715e-01f, 9.217077493667603e-01f,
          9.227461218833923e-01f, 9.237783551216125e-01f, 9.248043894767761e-01f, 9.258242249488831e-01f,
          9.268378615379333e-01f, 9.278451800346375e-01f, 9.288463592529297e-01f, 9.298411011695862e-01f,
          9.308295845985413e-01f, 9.318118095397949e-01f, 9.327875971794128e-01f, 9.337571263313293e-01f,
          9.347202181816101e-01f, 9.356769323348999e-01f, 9.366272091865540e-01f, 9.375710487365723e-01f,
          9.385083913803101e-01f, 9.394392371177673e-01f, 9.403636455535889e-01f, 9.412814974784851e-01f,
          9.421927928924561e-01f, 9.430975914001465e-01f, 9.439958333969116e-01f, 9.448874592781067e-01f,
          9.457725286483765e-01f, 9.466509222984314e-01f, 9.475226998329163e-01f, 9.483878016471863e-01f,
          9.492462277412415e-01f, 9.500979781150818e-01f, 9.509429931640625e-01f, 9.517813324928284e-01f,
          9.526129364967346e-01f, 9.534376859664917e-01f, 9.542557597160339e-01f, 9.550669789314270e-01f,
          9.558714032173157e-01f, 9.566690921783447e-01f, 9.574598073959351e-01f, 9.582436680793762e-01f,
          9.590207338333130e-01f, 9.597908854484558e-01f, 9.605541229248047e-01f, 9.613104462623596e-01f,
          9.620598554611206e-01f, 9.628022909164429e-01f, 9.635377526283264e-01f, 9.642663002014160e-01f,
          9.649877548217773e-01f, 9.657022356987000e-01f, 9.664096832275391e-01f, 9.671101570129395e-01f,
          9.678035378456116e-01f, 9.684898853302002e-01f, 9.691691398620605e-01f, 9.698412418365479e-01f,
          9.705063104629517e-01f, 9.711642861366272e-01f, 9.718150496482849e-01f, 9.724587202072144e-01f,
          9.730952382087708e-01f, 9.737245440483093e-01f, 9.743467569351196e-01f, 9.749616384506226e-01f,
          9.755693674087524e-01f, 9.761698842048645e-01f, 9.767631292343140e-01f, 9.773491621017456e-01f,
          9.779279232025146e-01f, 9.784994721412659e-01f, 9.790636897087097e-01f, 9.796205759048462e-01f,
          9.801702499389648e-01f, 9.807125329971313e-01f, 9.812476038932800e-01f, 9.817751646041870e-01f,
          9.822955131530762e-01f, 9.828084707260132e-01f, 9.833140373229980e-01f, 9.838121533393860e-01f,
          9.843029975891113e-01f, 9.847863912582397e-01f, 9.852624535560608e-01f, 9.857310056686401e-01f,
          9.861922264099121e-01f, 9.866459369659424e-01f, 9.870921969413757e-01f, 9.875310063362122e-01f,
          9.879623651504517e-01f, 9.883862733840942e-01f, 9.888026714324951e-01f, 9.892115592956543e-01f,
          9.896129965782166e-01f, 9.900069236755371e-01f, 9.903932809829712e-01f, 9.907721877098083e-01f,
          9.911435246467590e-01f, 9.915072917938232e-01f, 9.918636083602905e-01f, 9.922122955322266e-01f,
          9.925534725189209e-01f, 9.928870797157288e-01f, 9.932130575180054e-01f, 9.935314059257507e-01f,
          9.938422441482544e-01f, 9.941455125808716e-01f, 9.944411516189575e-01f, 9.947292208671570e-01f,
          9.950096607208252e-01f, 9.952824711799622e-01f, 9.955477118492126e-01f, 9.958052635192871e-01f,
          9.960552453994751e-01f, 9.962975382804871e-01f, 9.965322017669678e-01f, 9.967591762542725e-01f,
          9.969785213470459e-01f, 9.971902370452881e-01f, 9.973943233489990e-01f, 9.975906610488892e-01f,
          9.977793693542480e-01f, 9.979604482650757e-01f, 9.981337785720825e-01f, 9.982994198799133e-01f,
          9.984574317932129e-01f, 9.986077547073364e-01f, 9.987503886222839e-01f, 9.988852739334106e-01f,
          9.990124702453613e-01f, 9.991320371627808e-01f, 9.992438554763794e-01f, 9.993480443954468e-01f,
          9.994443655014038e-01f, 9.995331168174744e-01f, 9.996141791343689e-01f, 9.996874928474426e-01f,
          9.997529983520508e-01f, 9.998108744621277e-01f, 9.998611211776733e-01f, 9.999035596847534e-01f,
          9.999383091926575e-01f, 9.999653100967407e-01f, 9.999845623970032e-01f, 9.999961853027344e-01f,
          1.000000000000000e+00f, 9.999961853027344e-01f, 9.999845623970032e-01f, 9.999653100967407e-01f,
          9.999383091926575e-01f, 9.999035596847534e-01f, 9.998611211776733e-01f, 9.998108744621277e-01f,
          9.997529983520508e-01f, 9.996874928474426e-01f, 9.996141791343689e-01f, 9.995331168174744e-01f,
          9.994443655014038e-01f, 9.993480443954468e-01f, 9.992438554763794e-01f, 9.991320371627808e-01f,
          9.990124702453613e-01f, 9.988852739334106e-01f, 9.987503290176392e-01f, 9.986077547073364e-01f,
          9.984573721885681e-01f, 9.982994198799133e-01f, 9.981337189674377e-01f, 9.979604482650757e-01f,
          9.977793693542480e-01f, 9.975906610488892e-01f, 9.973943233489990e-01f, 9.971902370452881e-01f,
          9.969785213470459e-01f, 9.967591762542725e-01f, 9.965322017669678e-01f, 9.962974786758423e-01f,
          9.960552453994751e-01f, 9.958052635192871e-01f, 9.955476522445679e-01f, 9.952824711799622e-01f,
          9.950096607208252e-01f, 9.947292208671570e-01f, 9.944411516189575e-01f, 9.941455125808716e-01f,
          9.938422441482544e-01f, 9.935314059257507e-01f, 9.932130575180054e-01f, 9.928870201110840e-01f,
          9.925534129142761e-01f, 9.922122955322266e-01f, 9.918635487556458e-01f, 9.915072917938232e-01f,
          9.911434650421143e-01f, 9.907721877098083e-01f, 9.903932809829712e-01f, 9.900068640708923e-01f,
          9.896129965782166e-01f, 9.892115592956543e-01f, 9.888026714324951e-01f, 9.883862733840942e-01f,
          9.879623651504517e-01f, 9.875310063362122e-01f, 9.870921969413757e-01f, 9.866458773612976e-01f,
          9.861922264099121e-01f, 9.857310056686401e-01f, 9.852623939514160e-01f, 9.847863912582397e-01f,
          9.843029975891113e-01f, 9.838121533393860e-01f, 9.833140373229980e-01f, 9.828084111213684e-01f,
          9.822954535484314e-01f, 9.817751049995422e-01f, 9.812475442886353e-01f, 9.807125329971313e-01f,
          9.801702499389648e-01f, 9.796205759048462e-01f, 9.790636301040649e-01f, 9.784994125366211e-01f,
          9.779279232025146e-01f, 9.773491621017456e-01f, 9.767631292343140e-01f, 9.761698246002197e-01f,
          9.755693674087524e-01f, 9.749615788459778e-01f, 9.743466377258301e-01f, 9.737244844436646e-01f,
          9.730952382087708e-01f, 9.724587202072144e-01f, 9.718149900436401e-01f, 9.711642265319824e-01f,
          9.705063104629517e-01f, 9.698412418365479e-01f, 9.691690802574158e-01f, 9.684898853302002e-01f,
          9.678035378456116e-01f, 9.671101570129395e-01f, 9.664096832275391e-01f, 9.657022356987000e-01f,
          9.649876952171326e-01f, 9.642662405967712e-01f, 9.635377526283264e-01f, 9.628022313117981e-01f,
          9.620598554611206e-01f, 9.613104462623596e-01f, 9.605540633201599e-01f, 9.597908258438110e-01f,
          9.590206742286682e-01f, 9.582436680793762e-01f, 9.574597477912903e-01f, 9.566689729690552e-01f,
          9.558713436126709e-01f, 9.550669193267822e-01f, 9.542557001113892e-01f, 9.534376859664917e-01f,
          9.526128768920898e-01f, 9.517813324928284e-01f, 9.509429931640625e-01f, 9.500979185104370e-01f,
          9.492461681365967e-01f, 9.483877420425415e-01f, 9.475226402282715e-01f, 9.466508626937866e-01f,
          9.457724690437317e-01f, 9.448873996734619e-01f, 9.439958333969116e-01f, 9.430975914001465e-01f,
          9.421927928924561e-01f, 9.412814974784851e-01f, 9.403636455535889e-01f, 9.394391775131226e-01f,
          9.385083317756653e-01f, 9.375709295272827e-01f, 9.366271495819092e-01f, 9.356768727302551e-01f,
          9.347201585769653e-01f, 9.337570667266846e-01f, 9.327875971794128e-01f, 9.318117499351501e-01f,
          9.308295845985413e-01f, 9.298410415649414e-01f, 9.288462400436401e-01f, 9.278451800346375e-01f,
          9.268378019332886e-01f, 9.258242249488831e-01f, 9.248043298721313e-01f, 9.237782955169678e-01f,
          9.227460622787476e-01f, 9.217076897621155e-01f, 9.206631183624268e-01f, 9.196124672889709e-01f,
          9.185556769371033e-01f, 9.174928665161133e-01f, 9.164239764213562e-01f, 9.153489470481873e-01f,
          9.142680168151855e-01f, 9.131811261177063e-01f, 9.120882153511047e-01f, 9.109892845153809e-01f,
          9.098845124244690e-01f, 9.087737202644348e-01f, 9.076570868492126e-01f, 9.065346121788025e-01f,
          9.054062366485596e-01f, 9.042720794677734e-01f, 9.031321406364441e-01f, 9.019863605499268e-01f,
          9.008348584175110e-01f, 8.996775746345520e-01f, 8.985146284103394e-01f, 8.973460197448730e-01f,
          8.961717486381531e-01f, 8.949917554855347e-01f, 8.938061594963074e-01f, 8.926149606704712e-01f,
          8.914182186126709e-01f, 8.902159333229065e-01f, 8.890081644058228e-01f, 8.877947926521301e-01f,
          8.865760564804077e-01f, 8.853517174720764e-01f, 8.841220140457153e-01f, 8.828868865966797e-01f,
          8.816465139389038e-01f, 8.804007172584534e-01f, 8.791494965553284e-01f, 8.778930306434631e-01f,
          8.766312003135681e-01f, 8.753641247749329e-01f, 8.740918636322021e-01f, 8.728142976760864e-01f,
          8.715316653251648e-01f, 8.702437877655029e-01f, 8.689507842063904e-01f, 8.676527142524719e-01f,
          8.663495182991028e-01f, 8.650411963462830e-01f, 8.637278676033020e-01f, 8.624095320701599e-01f,
          8.610862493515015e-01f, 8.597579598426819e-01f, 8.584247231483459e-01f, 8.570865988731384e-01f,
          8.557435274124146e-01f, 8.543956875801086e-01f, 8.530429601669312e-01f, 8.516854047775269e-01f,
          8.503230810165405e-01f, 8.489559888839722e-01f, 8.475841879844666e-01f, 8.462076187133789e-01f,
          8.448265790939331e-01f, 8.434407114982605e-01f, 8.420502543449402e-01f, 8.406551480293274e-01f,
          8.392555117607117e-01f, 8.378512859344482e-01f, 8.364425301551819e-01f, 8.350293040275574e-01f,
          8.336116075515747e-01f, 8.321895599365234e-01f, 8.307629227638245e-01f, 8.293319940567017e-01f,
          8.278966546058655e-01f, 8.264570832252502e-01f, 8.250131607055664e-01f, 8.235648870468140e-01f,
          8.221123814582825e-01f, 8.206557035446167e-01f, 8.191947937011719e-01f, 8.177297711372375e-01f,
          8.162605166435242e-01f, 8.147871494293213e-01f, 8.133097290992737e-01f, 8.118282556533813e-01f,
          8.103427886962891e-01f, 8.088532686233521e-01f, 8.073598146438599e-01f, 8.058623671531677e-01f,
          8.043611049652100e-01f, 8.028558492660522e-01f, 8.013467192649841e-01f, 7.998337745666504e-01f,
          7.983169555664062e-01f, 7.967963814735413e-01f, 7.952720522880554e-01f, 7.937440276145935e-01f,
          7.922123074531555e-01f, 7.906769514083862e-01f, 7.891378402709961e-01f, 7.875952124595642e-01f,
          7.860489487648010e-01f, 7.844991087913513e-01f, 7.829458117485046e-01f, 7.813889980316162e-01f,
          7.798286676406860e-01f, 7.782649397850037e-01f, 7.766977548599243e-01f, 7.751272320747375e-01f,
          7.735533714294434e-01f, 7.719761133193970e-01f, 7.703955769538879e-01f, 7.688117623329163e-01f,
          7.672247290611267e-01f, 7.656344771385193e-01f, 7.640410661697388e-01f, 7.624445557594299e-01f,
          7.608448266983032e-01f, 7.592420578002930e-01f, 7.576361894607544e-01f, 7.560272216796875e-01f,
          7.544153332710266e-01f, 7.528004646301270e-01f, 7.511826157569885e-01f, 7.495617866516113e-01f,
          7.479380965232849e-01f, 7.463115453720093e-01f, 7.446821928024292e-01f, 7.430499792098999e-01f,
          7.414149641990662e-01f, 7.397772669792175e-01f, 7.381368875503540e-01f, 7.364937067031860e-01f,
          7.348480224609375e-01f, 7.331996560096741e-01f, 7.315485477447510e-01f, 7.298950552940369e-01f,
          7.282388806343079e-01f, 7.265802025794983e-01f, 7.249190807342529e-01f, 7.232554554939270e-01f,
          7.215894460678101e-01f, 7.199209928512573e-01f, 7.182502746582031e-01f, 7.165770530700684e-01f,
          7.149016261100769e-01f, 7.132238745689392e-01f, 7.115439772605896e-01f, 7.098617553710938e-01f,
          7.081773877143860e-01f, 7.064908146858215e-01f, 7.048021554946899e-01f, 7.031113505363464e-01f,
          7.014185190200806e-01f, 6.997236013412476e-01f, 6.980265974998474e-01f, 6.963276863098145e-01f,
          6.946268081665039e-01f, 6.929240822792053e-01f, 6.912193298339844e-01f, 6.895127892494202e-01f,
          6.878042817115784e-01f, 6.860941052436829e-01f, 6.843820810317993e-01f, 6.826683282852173e-01f,
          6.809528470039368e-01f, 6.792356371879578e-01f, 6.775168180465698e-01f, 6.757963299751282e-01f,
          6.740742325782776e-01f, 6.723505258560181e-01f, 6.706253290176392e-01f, 6.688985824584961e-01f,
          6.671702861785889e-01f, 6.654406785964966e-01f, 6.637095212936401e-01f, 6.619769930839539e-01f,
          6.602430343627930e-01f, 6.585077643394470e-01f, 6.567712426185608e-01f, 6.550333499908447e-01f,
          6.532942652702332e-01f, 6.515539288520813e-01f, 6.498123407363892e-01f, 6.480696797370911e-01f,
          6.463257670402527e-01f, 6.445810198783875e-01f, 6.428350210189819e-01f, 6.410878300666809e-01f,
          6.393396854400635e-01f, 6.375905871391296e-01f, 6.358404159545898e-01f, 6.340893507003784e-01f,
          6.323373913764954e-01f, 6.305844783782959e-01f, 6.288307905197144e-01f, 6.270762681961060e-01f,
          6.253209114074707e-01f, 6.235647797584534e-01f, 6.218079328536987e-01f, 6.200503706932068e-01f,
          6.182920932769775e-01f, 6.165331602096558e-01f, 6.147736310958862e-01f, 6.130135059356689e-01f,
          6.112527251243591e-01f, 6.094915270805359e-01f, 6.077296733856201e-01f, 6.059674024581909e-01f,
          6.042046546936035e-01f, 6.024415493011475e-01f, 6.006779074668884e-01f, 5.989140272140503e-01f,
          5.971497297286987e-01f, 5.953850746154785e-01f, 5.936200618743896e-01f, 5.918549299240112e-01f,
          5.900895595550537e-01f, 5.883238911628723e-01f, 5.865580439567566e-01f, 5.847920775413513e-01f,
          5.830259919166565e-01f, 5.812597870826721e-01f, 5.794935226440430e-01f, 5.777271986007690e-01f,
          5.759608745574951e-01f, 5.741944909095764e-01f, 5.724282264709473e-01f, 5.706619620323181e-01f,
          5.688958168029785e-01f, 5.671297907829285e-01f, 5.653638839721680e-01f, 5.635981559753418e-01f,
          5.618326663970947e-01f, 5.600673556327820e-01f, 5.583022832870483e-01f, 5.565375089645386e-01f,
          5.547730326652527e-01f, 5.530088543891907e-01f, 5.512450933456421e-01f, 5.494816303253174e-01f,
          5.477188825607300e-01f, 5.459563732147217e-01f, 5.441942214965820e-01f, 5.424326062202454e-01f,
          5.406714677810669e-01f, 5.389108657836914e-01f, 5.371508598327637e-01f, 5.353915095329285e-01f,
          5.336326956748962e-01f, 5.318745374679565e-01f, 5.301170349121094e-01f, 5.283601880073547e-01f,
          5.266041159629822e-01f, 5.248487591743469e-01f, 5.230941772460938e-01f, 5.213404297828674e-01f,
          5.195874571800232e-01f, 5.178352594375610e-01f, 5.160840749740601e-01f, 5.143336653709412e-01f,
          5.125842690467834e-01f, 5.108357667922974e-01f, 5.090882182121277e-01f, 5.073416829109192e-01f,
          5.055961608886719e-01f, 5.038517117500305e-01f, 5.021082758903503e-01f, 5.003659725189209e-01f,
          4.986246824264526e-01f, 4.968846440315247e-01f, 4.951457083225250e-01f, 4.934080243110657e-01f,
          4.916714727878571e-01f, 4.899362325668335e-01f, 4.882021546363831e-01f, 4.864694774150848e-01f,
          4.847379922866821e-01f, 4.830079078674316e-01f, 4.812791347503662e-01f, 4.795517325401306e-01f,
          4.778257608413696e-01f, 4.761011898517609e-01f, 4.743780791759491e-01f, 4.726563990116119e-01f,
          4.709362387657166e-01f, 4.692175984382629e-01f, 4.675005078315735e-01f, 4.657849371433258e-01f,
          4.640709161758423e-01f, 4.623585939407349e-01f, 4.606478214263916e-01f, 4.589387774467468e-01f,
          4.572313427925110e-01f, 4.555255472660065e-01f, 4.538215398788452e-01f, 4.521195292472839e-01f,
          4.504189789295197e-01f, 4.487202465534210e-01f, 4.470233023166656e-01f, 4.453281760215759e-01f,
          4.436348676681519e-01f, 4.419434666633606e-01f, 4.402538836002350e-01f, 4.385662674903870e-01f,
          4.368805587291718e-01f, 4.351968169212341e-01f, 4.335150122642517e-01f, 4.318352341651917e-01f,
          4.301574230194092e-01f, 4.284816682338715e-01f, 4.268079400062561e-01f, 4.251363277435303e-01f,
          4.234668314456940e-01f, 4.217993915081024e-01f, 4.201340675354004e-01f, 4.184709787368774e-01f,
          4.168100059032440e-01f, 4.151512086391449e-01f, 4.134946465492249e-01f, 4.118403196334839e-01f,
          4.101882278919220e-01f, 4.085384309291840e-01f, 4.068908691406250e-01f, 4.052456617355347e-01f,
          4.036027789115906e-01f, 4.019622504711151e-01f, 4.003240466117859e-01f, 3.986882567405701e-01f,
          3.970548510551453e-01f, 3.954238891601562e-01f, 3.937953412532806e-01f, 3.921692669391632e-01f,
          3.905456662178040e-01f, 3.889245390892029e-01f, 3.873059153556824e-01f, 3.856898546218872e-01f,
          3.840763270854950e-01f, 3.824653625488281e-01f, 3.808569908142090e-01f, 3.792511820793152e-01f,
          3.776480555534363e-01f, 3.760474920272827e-01f, 3.744496107101440e-01f, 3.728543817996979e-01f,
          3.712618649005890e-01f, 3.696720302104950e-01f, 3.680849075317383e-01f, 3.665005266666412e-01f,
          3.649188876152039e-01f, 3.633400201797485e-01f, 3.617639541625977e-01f, 3.601908981800079e-01f,
          3.586204349994659e-01f, 3.570528030395508e-01f, 3.554880023002625e-01f, 3.539260923862457e-01f,
          3.523670136928558e-01f, 3.508108556270599e-01f, 3.492575883865356e-01f, 3.477073013782501e-01f,
          3.461599051952362e-01f, 3.446154594421387e-01f, 3.430739641189575e-01f, 3.415355086326599e-01f,
          3.400000333786011e-01f, 3.384675383567810e-01f, 3.369380831718445e-01f, 3.354116678237915e-01f,
          3.338883221149445e-01f, 3.323680460453033e-01f, 3.308508396148682e-01f, 3.293367326259613e-01f,
          3.278257250785828e-01f, 3.263178765773773e-01f, 3.248131275177002e-01f, 3.233115375041962e-01f,
          3.218131065368652e-01f, 3.203178644180298e-01f, 3.188258111476898e-01f, 3.173369467258453e-01f,
          3.158513307571411e-01f, 3.143689036369324e-01f, 3.128897547721863e-01f, 3.114138543605804e-01f,
          3.099412024021149e-01f, 3.084717988967896e-01f, 3.070057332515717e-01f, 3.055429756641388e-01f,
          3.040835261344910e-01f, 3.026273846626282e-01f, 3.011745512485504e-01f, 2.997251152992249e-01f,
          2.982790470123291e-01f, 2.968363165855408e-01f, 2.953969836235046e-01f, 2.939610183238983e-01f,
          2.925284802913666e-01f, 2.910993695259094e-01f, 2.896736860275269e-01f, 2.882513999938965e-01f,
          2.868326008319855e-01f, 2.854172289371490e-01f, 2.840053737163544e-01f, 2.825969457626343e-01f,
          2.811920344829559e-01f, 2.797905802726746e-01f, 2.783928811550140e-01f, 2.769984900951385e-01f,
          2.756076157093048e-01f, 2.742202877998352e-01f, 2.728364765644073e-01f, 2.714562416076660e-01f,
          2.700795829296112e-01f, 2.687065005302429e-01f, 2.673369646072388e-01f, 2.659710347652435e-01f,
          2.646087110042572e-01f, 2.632499933242798e-01f, 2.618948817253113e-01f, 2.605434060096741e-01f,
          2.591955363750458e-01f, 2.578513026237488e-01f, 2.565107643604279e-01f, 2.551738619804382e-01f,
          2.538406252861023e-01f, 2.525110840797424e-01f, 2.511851787567139e-01f, 2.498629540205002e-01f,
          2.485444545745850e-01f, 2.472296357154846e-01f, 2.459185421466827e-01f, 2.446111738681793e-01f,
          2.433075010776520e-01f, 2.420075535774231e-01f, 2.407113611698151e-01f, 2.394188940525055e-01f,
          2.381301820278168e-01f, 2.368452101945877e-01f, 2.355640381574631e-01f, 2.342865914106369e-01f,
          2.330129444599152e-01f, 2.317430526018143e-01f, 2.304769456386566e-01f, 2.292146533727646e-01f,
          2.279561161994934e-01f, 2.267014086246490e-01f, 2.254505157470703e-01f, 2.242034077644348e-01f,
          2.229601442813873e-01f, 2.217206656932831e-01f, 2.204850018024445e-01f, 2.192532122135162e-01f,
          2.180252373218536e-01f, 2.168011069297791e-01f, 2.155808210372925e-01f, 2.143643498420715e-01f,
          2.131517678499222e-01f, 2.119430005550385e-01f, 2.107381522655487e-01f, 2.095371186733246e-01f,
          2.083399891853333e-01f, 2.071468532085419e-01f, 2.059574723243713e-01f, 2.047719210386276e-01f,
          2.035902738571167e-01f, 2.024125456809998e-01f, 2.012386322021484e-01f, 2.000686824321747e-01f,
          1.989025473594666e-01f, 1.977403610944748e-01f, 1.965820640325546e-01f, 1.954276561737061e-01f,
          1.942771673202515e-01f, 1.931305527687073e-01f, 1.919878870248795e-01f, 1.908491253852844e-01f,
          1.897142529487610e-01f, 1.885833144187927e-01f, 1.874562650918961e-01f, 1.863331496715546e-01f,
          1.852139532566071e-01f, 1.840986758470535e-01f, 1.829873174428940e-01f, 1.818798780441284e-01f,
          1.807763874530792e-01f, 1.796768009662628e-01f, 1.785811334848404e-01f, 1.774893999099731e-01f,
          1.764016151428223e-01f, 1.753177344799042e-01f, 1.742377877235413e-01f, 1.731617897748947e-01f,
          1.720896959304810e-01f, 1.710215508937836e-01f, 1.699573397636414e-01f, 1.688970476388931e-01f,
          1.678406894207001e-01f, 1.667882651090622e-01f, 1.657397598028183e-01f, 1.646952033042908e-01f,
          1.636545658111572e-01f, 1.626178622245789e-01f, 1.615850925445557e-01f, 1.605562567710876e-01f,
          1.595313251018524e-01f, 1.585103273391724e-01f, 1.574932634830475e-01f, 1.564801186323166e-01f,
          1.554709225893021e-01f, 1.544656157493591e-01f, 1.534642428159714e-01f, 1.524667888879776e-01f,
          1.514732539653778e-01f, 1.504836529493332e-01f, 1.494979560375214e-01f, 1.485161632299423e-01f,
          1.475382894277573e-01f, 1.465644836425781e-01f, 1.455944329500198e-01f, 1.446282714605331e-01f,
          1.436660289764404e-01f, 1.427076905965805e-01f, 1.417532414197922e-01f, 1.408026963472366e-01f,
          1.398560404777527e-01f, 1.389132887125015e-01f, 1.379744112491608e-01f, 1.370394229888916e-01f,
          1.361083388328552e-01f, 1.351811140775681e-01f, 1.342577636241913e-01f, 1.333382874727249e-01f,
          1.324226856231689e-01f, 1.315109729766846e-01f, 1.306030899286270e-01f, 1.296990960836411e-01f,
          1.287989616394043e-01f, 1.279026567935944e-01f, 1.270102262496948e-01f, 1.261216253042221e-01f,
          1.252368837594986e-01f, 1.243559569120407e-01f, 1.234789043664932e-01f, 1.226056516170502e-01f,
          1.217362433671951e-01f, 1.208706349134445e-01f, 1.200088635087013e-01f, 1.191508919000626e-01f,
          1.182967573404312e-01f, 1.174464076757431e-01f, 1.165998727083206e-01f, 1.157571151852608e-01f,
          1.149181649088860e-01f, 1.140829920768738e-01f, 1.132516264915466e-01f, 1.124240010976791e-01f,
          1.116001680493355e-01f, 1.107800826430321e-01f, 1.099637821316719e-01f, 1.091512292623520e-01f,
          1.083424240350723e-01f, 1.075373888015747e-01f, 1.067360714077950e-01f, 1.059384867548943e-01f,
          1.051446422934532e-01f, 1.043545305728912e-01f, 1.035681217908859e-01f, 1.027854382991791e-01f,
          1.020064577460289e-01f, 1.012311950325966e-01f, 1.004596054553986e-01f, 9.969171881675720e-02f,
          9.892760217189789e-02f, 9.816709160804749e-02f, 9.741023182868958e-02f, 9.665701538324356e-02f,
          9.590747952461243e-02f, 9.516161680221558e-02f, 9.441936016082764e-02f, 9.368076920509338e-02f,
          9.294581413269043e-02f, 9.221448004245758e-02f, 9.148675203323364e-02f, 9.076267480850220e-02f,
          9.004216641187668e-02f, 8.932529389858246e-02f, 8.861199021339417e-02f, 8.790227770805359e-02f,
          8.719613403081894e-02f, 8.649358153343201e-02f, 8.579458296298981e-02f, 8.509917557239532e-02f,
          8.440727740526199e-02f, 8.371893316507339e-02f, 8.303415775299072e-02f, 8.235286921262741e-02f,
          8.167514204978943e-02f, 8.100089430809021e-02f, 8.033017814159393e-02f, 7.966295629739761e-02f,
          7.899925857782364e-02f, 7.833899557590485e-02f, 7.768224179744720e-02f, 7.702897489070892e-02f,
          7.637912780046463e-02f, 7.573276013135910e-02f, 7.508983463048935e-02f, 7.445035129785538e-02f,
          7.381432503461838e-02f, 7.318168878555298e-02f, 7.255249470472336e-02f, 7.192667573690414e-02f,
          7.130427658557892e-02f, 7.068529725074768e-02f, 7.006966322660446e-02f, 6.945742666721344e-02f,
          6.884855777025223e-02f, 6.824304163455963e-02f, 6.764088571071625e-02f, 6.704207509756088e-02f,
          6.644653528928757e-02f, 6.585439294576645e-02f, 6.526556611061096e-02f, 6.468003988265991e-02f,
          6.409782916307449e-02f, 6.351888179779053e-02f, 6.294327229261398e-02f, 6.237098574638367e-02f,
          6.180189922451973e-02f, 6.123606115579605e-02f, 6.067348271608353e-02f, 6.011414900422096e-02f,
          5.955803766846657e-02f, 5.900519341230392e-02f, 5.845553427934647e-02f, 5.790907517075539e-02f,
          5.736582726240158e-02f, 5.682576820254326e-02f, 5.628888309001923e-02f, 5.575518310070038e-02f,
          5.522464960813522e-02f, 5.469729751348495e-02f, 5.417307093739510e-02f, 5.365198478102684e-02f,
          5.313402414321899e-02f, 5.261919647455215e-02f, 5.210745334625244e-02f, 5.159883946180344e-02f,
          5.109330639243126e-02f, 5.059089139103889e-02f, 5.009152367711067e-02f, 4.959523677825928e-02f,
          4.910198599100113e-02f, 4.861181974411011e-02f, 4.812467470765114e-02f, 4.764057695865631e-02f,
          4.715947061777115e-02f, 4.668140411376953e-02f, 4.620632156729698e-02f, 4.573427140712738e-02f,
          4.526519775390625e-02f, 4.479908943176270e-02f, 4.433592781424522e-02f, 4.387578368186951e-02f,
          4.341854900121689e-02f, 4.296426475048065e-02f, 4.251291975378990e-02f, 4.206448793411255e-02f,
          4.161898419260979e-02f, 4.117639362812042e-02f, 4.073669016361237e-02f, 4.029986634850502e-02f,
          3.986592590808868e-02f, 3.943485766649246e-02f, 3.900664299726486e-02f, 3.858126327395439e-02f,
          3.815875947475433e-02f, 3.773905709385872e-02f, 3.732219338417053e-02f, 3.690815716981888e-02f,
          3.649692982435226e-02f, 3.608848899602890e-02f, 3.568282723426819e-02f, 3.527999669313431e-02f,
          3.487988561391830e-02f, 3.448252379894257e-02f, 3.408795595169067e-02f, 3.369607776403427e-02f,
          3.330698981881142e-02f, 3.292058780789375e-02f, 3.253687918186188e-02f, 3.215590864419937e-02f,
          3.177763149142265e-02f, 3.140203282237053e-02f, 3.102915361523628e-02f, 3.065888211131096e-02f,
          3.029133006930351e-02f, 2.992638573050499e-02f, 2.956412360072136e-02f, 2.920446917414665e-02f,
          2.884743362665176e-02f, 2.849303185939789e-02f, 2.814121916890144e-02f, 2.779203280806541e-02f,
          2.744543552398682e-02f, 2.710140496492386e-02f, 2.675995603203773e-02f, 2.642104402184486e-02f,
          2.608474344015121e-02f, 2.575094252824783e-02f, 2.541969344019890e-02f, 2.509095147252083e-02f,
          2.476475015282631e-02f, 2.444108203053474e-02f, 2.411986887454987e-02f, 2.380118519067764e-02f,
          2.348499000072479e-02f, 2.317125722765923e-02f, 2.285998314619064e-02f, 2.255117520689964e-02f,
          2.224482223391533e-02f, 2.194093540310860e-02f, 2.163944393396378e-02f, 2.134041860699654e-02f,
          2.104378491640091e-02f, 2.074956148862839e-02f, 2.045773342251778e-02f, 2.016830816864967e-02f,
          1.988128200173378e-02f, 1.959659531712532e-02f, 1.931431144475937e-02f, 1.903437823057175e-02f,
          1.875680312514305e-02f, 1.848155260086060e-02f, 1.820863783359528e-02f, 1.793808117508888e-02f,
          1.766983047127724e-02f, 1.740387082099915e-02f, 1.714028418064117e-02f, 1.687890291213989e-02f,
          1.661986112594604e-02f, 1.636309176683426e-02f, 1.610857993364334e-02f, 1.585633680224419e-02f,
          1.560631766915321e-02f, 1.535860449075699e-02f, 1.511309668421745e-02f, 1.486983522772789e-02f,
          1.462877541780472e-02f, 1.438996940851212e-02f, 1.415334641933441e-02f, 1.391893625259399e-02f,
          1.368674635887146e-02f, 1.345672830939293e-02f, 1.322886347770691e-02f, 1.300320401787758e-02f,
          1.277970522642136e-02f, 1.255835965275764e-02f, 1.233917474746704e-02f, 1.212211698293686e-02f,
          1.190720126032829e-02f, 1.169441640377045e-02f, 1.148378103971481e-02f, 1.127524673938751e-02f,
          1.106880977749825e-02f, 1.086448505520821e-02f, 1.066226139664650e-02f, 1.046212017536163e-02f,
          1.026406139135361e-02f, 1.006807386875153e-02f, 9.874165058135986e-03f, 9.682305157184601e-03f,
          9.492523968219757e-03f, 9.304776787757874e-03f, 9.119071066379547e-03f, 8.935384452342987e-03f,
          8.753754198551178e-03f, 8.574165403842926e-03f, 8.396558463573456e-03f, 8.220978081226349e-03f,
          8.047401905059814e-03f, 7.875822484493256e-03f, 7.706232368946075e-03f, 7.538646459579468e-03f,
          7.373020052909851e-03f, 7.209375500679016e-03f, 7.047712802886963e-03f, 6.887987256050110e-03f,
          6.730243563652039e-03f, 6.574451923370361e-03f, 6.420597434043884e-03f, 6.268694996833801e-03f,
          6.118714809417725e-03f, 5.970694124698639e-03f, 5.824580788612366e-03f, 5.680389702320099e-03f,
          5.538083612918854e-03f, 5.397707223892212e-03f, 5.259223282337189e-03f, 5.122661590576172e-03f,
          4.987977445125580e-03f, 4.855185747146606e-03f, 4.724293947219849e-03f, 4.595249891281128e-03f,
          4.468075931072235e-03f, 4.342801868915558e-03f, 4.219390451908112e-03f, 4.097826778888702e-03f,
          3.978110849857330e-03f, 3.860257565975189e-03f, 3.744229674339294e-03f, 3.630056977272034e-03f,
          3.517732024192810e-03f, 3.407239913940430e-03f, 3.298565745353699e-03f, 3.191731870174408e-03f,
          3.086671233177185e-03f, 2.983495593070984e-03f, 2.882078289985657e-03f, 2.782486379146576e-03f,
          2.684719860553741e-03f, 2.588734030723572e-03f, 2.494528889656067e-03f, 2.402156591415405e-03f,
          2.311550080776215e-03f, 2.222754061222076e-03f, 2.135716378688812e-03f, 2.050451934337616e-03f,
          1.966968178749084e-03f, 1.885280013084412e-03f, 1.805350184440613e-03f, 1.727171242237091e-03f,
          1.650780439376831e-03f, 1.576140522956848e-03f, 1.503258943557739e-03f, 1.432120800018311e-03f,
          1.362740993499756e-03f, 1.295126974582672e-03f, 1.229226589202881e-03f, 1.165084540843964e-03f,
          1.102678477764130e-03f, 1.042045652866364e-03f, 9.831190109252930e-04f, 9.259283542633057e-04f,
          8.704587817192078e-04f, 8.167475461959839e-04f, 7.647275924682617e-04f, 7.144585251808167e-04f,
          6.659254431724548e-04f, 6.190985441207886e-04f, 5.739927291870117e-04f, 5.305856466293335e-04f,
          4.889219999313354e-04f, 4.489496350288391e-04f, 4.106983542442322e-04f, 3.741532564163208e-04f,
          3.393292427062988e-04f, 3.061890602111816e-04f, 2.747699618339539e-04f, 2.450644969940186e-04f,
          2.170652151107788e-04f, 1.907572150230408e-04f, 1.661553978919983e-04f, 1.432672142982483e-04f,
          1.220479607582092e-04f, 1.025646924972534e-04f, 8.475035429000854e-05f, 6.864964962005615e-05f,
          5.424022674560547e-05f, 4.153698682785034e-05f, 3.050267696380615e-05f, 2.119690179824829e-05f,
          1.356005668640137e-05f, 7.651746273040771e-06f, 3.412365913391113e-06f, 8.642673492431641e-07f };

FeatureGenerator::FeatureGenerator()
    : initialized(false), fft_handle(nullptr), fft_input_buffer(nullptr), log_features_buffer(nullptr),
      audio_float_buffer(nullptr)
{
}

FeatureGenerator::~FeatureGenerator()
{
    if (fft_handle)
    {
        dl_rfft_f32_deinit(fft_handle);
        fft_handle = nullptr;
    }
    if (fft_input_buffer)
    {
        heap_caps_free(fft_input_buffer);
        fft_input_buffer = nullptr;
    }
    if (log_features_buffer)
    {
        heap_caps_free(log_features_buffer);
        log_features_buffer = nullptr;
    }
    if (audio_float_buffer)
    {
        heap_caps_free(audio_float_buffer);
        audio_float_buffer = nullptr;
    }
}

bool FeatureGenerator::init()
{
    // Allocate buffers
    fft_input_buffer = (float *)heap_caps_aligned_alloc(16, CONFIG_FFT_SIZE * sizeof(float), MALLOC_CAP_SPIRAM);
    log_features_buffer = (float *)heap_caps_aligned_alloc(16, CONFIG_OUTPUT_SIZE * sizeof(float), MALLOC_CAP_SPIRAM);
    audio_float_buffer = (float *)heap_caps_aligned_alloc(16, CONFIG_AUDIO_SAMPLES * sizeof(float), MALLOC_CAP_SPIRAM);

    if (!fft_input_buffer || !log_features_buffer || !audio_float_buffer)
    {
        ESP_LOGE(TAG, "Buffer allocation failed");
        return false;
    }

    // Initialize ESP-DL real FFT
    fft_handle = dl_rfft_f32_init(CONFIG_FFT_SIZE, MALLOC_CAP_SPIRAM);
    if (!fft_handle)
    {
        ESP_LOGE(TAG, "ESP-DL RFFT initialization failed");
        return false;
    }

    ESP_LOGI(TAG, "FeatureGenerator initialized successfully");
    initialized = true;
    return true;
}

void FeatureGenerator::convert_int16_to_float(const int16_t *input, float *output)
{
    for (size_t i = 0; i < CONFIG_AUDIO_SAMPLES; ++i)
    {
        output[i] = (float)input[i] / 32768.0f;
    }
}

void FeatureGenerator::prepare_frame(const float *audio_data, size_t frame_idx)
{
    size_t start_in_padded = frame_idx * CONFIG_HOP_LEN;
    size_t padding_size = CONFIG_HOP_LEN;
    for (size_t i = 0; i < CONFIG_HOP_LEN; ++i)
    {
        size_t pos_in_padded = start_in_padded + i;
        if (pos_in_padded < padding_size)
        {
            fft_input_buffer[i] = 0.0f;
        }
        else
        {
            fft_input_buffer[i] = audio_data[pos_in_padded - padding_size];
        }
    }
    memcpy(fft_input_buffer + CONFIG_HOP_LEN, audio_data + (frame_idx * CONFIG_HOP_LEN),
        CONFIG_HOP_LEN * sizeof(float));

    for (size_t i = 0; i < CONFIG_FRAME_LEN; ++i)
    {
        fft_input_buffer[i] *= g_hanning_window[i];
    }
}

void FeatureGenerator::normalize_globally(float *features, size_t total_features)
{
    double mean = 0.0f;
    for (size_t i = 0; i < total_features; ++i)
    {
        mean += features[i];
    }
    mean /= total_features;

    double variance = 0.0f;
    for (size_t i = 0; i < total_features; ++i)
    {
        float diff = features[i] - mean;
        variance += diff * diff;
    }
    variance /= total_features;
    float std_dev = sqrtf(variance);

    const float epsilon = 0.00009999999747378752f;
    float inv_std = 1.0f / (std_dev + epsilon);

    for (size_t i = 0; i < total_features; ++i)
    {
        features[i] = (features[i] - float(mean)) * inv_std;
    }
}

void FeatureGenerator::generate(const int16_t *raw_audio_data, float *output_features)
{
    if (!initialized)
    {
        ESP_LOGE(TAG, "FeatureGenerator not initialized");
        return;
    }

    ESP_LOGI(TAG, "Starting feature generation for %d frames", CONFIG_NUM_FRAMES);

    convert_int16_to_float(raw_audio_data, audio_float_buffer);

    for (size_t frame_idx = 0; frame_idx < CONFIG_NUM_FRAMES; ++frame_idx)
    {
        prepare_frame(audio_float_buffer, frame_idx);

        dl_rfft_f32_run(fft_handle, fft_input_buffer);

        float *current_log_features = log_features_buffer + (frame_idx * CONFIG_FEATURES_PER_FRAME);
        for (size_t j = 0; j < CONFIG_FEATURES_PER_FRAME; ++j)
        {
            float real = fft_input_buffer[j * 2 + 0];
            float imag = fft_input_buffer[j * 2 + 1];
            float mag = sqrtf(real * real + imag * imag);
            current_log_features[j] = logf(mag < 1e-12f ? 1e-12f : mag);
        }
    }

    normalize_globally(log_features_buffer, CONFIG_OUTPUT_SIZE);

    memcpy(output_features, log_features_buffer, CONFIG_OUTPUT_SIZE * sizeof(float));

    ESP_LOGI(TAG, "Feature generation completed, output size: %d", CONFIG_OUTPUT_SIZE);
}
